# general ----------

set -g default-terminal "screen-256color"
set -g base-index 1                       # windows start at 1
set -g pane-base-index 1                  # panes start at 1
set -g renumber-windows on                # renumber windows on close
set-option -g allow-rename off            # prevent window renaming
set -g mouse on                           # enable mouse control
bind r source-file ~/.tmux.conf           # reload config file on changes

set -s escape-time 0                      # https://github.com/tmux-plugins/tmux-sensible
set -g history-limit 50000
set -g display-time 4000
set -g status-interval 5
set -g status-keys emacs
set -g focus-events on
setw -g aggressive-resize on

# custom context menus ----------

# window status left menu
# https://github.com/tmux/tmux/blob/ae8f2208c98e3c2d6e3fe4cad2281dce8fd11f31/key-bindings.c#L470C4-L470C122
# -O option added to keep window open until option selected
bind -n MouseDown3StatusLeft { display-menu -O -t= -xM -yW -T '#[align=centre]#{session_name}'                 \
  Next                                a "switch-client -n"                                                     \
  Previous                            d "switch-client -p"                                                     \
  ""                                                                                                           \
  Rename                              r "command-prompt -I \"#S\" \"rename-session -- '%%'\""                  \
  ""                                                                                                           \
  "New Session"                       s new-session                                                            \
  "New Window"                        w "new-window -c \"#{pane_current_path}\""                               \
  "Switch to"                         s "run-shell ~/.tmux/plugins/tmux-sessionist/scripts/goto_session.sh"    \
  ""                                                                                                           \
  "Reload config"                     r "source-file ~/.tmux.conf \; display-message \"Config reloaded...\""   \
  "Install plugin"                    i "run-shell ~/.tmux/plugins/tpm/bindings/install_plugins"               \
  ""                                                                                                           \
  Detach                              d   detach-client                                                        \
}

# window tab menu
# https://github.com/tmux/tmux/blob/ae8f2208c98e3c2d6e3fe4cad2281dce8fd11f31/key-bindings.c#L474C4-L474C131    \
# -O option added to keep window open until option selected
bind -n MouseDown3Status { display-menu -O -t= -xW -yW -T '#[align=centre]#{window_index}:#{window_name}'      \
  "#{?pane_marked,Unmark,Mark}"       m "select-pane -m"                                                       \
  "#{?pane_marked_set,,-}Swap Marked" s swap-window                                                            \
  ""                                                                                                           \
  Rename                              r "command-prompt -I \"#W\" \"rename-window -- '%%'\""                   \
  ""                                                                                                           \
  "New After"                         w "new-window -a"                                                        \
  "New At End"                        W new-window                                                             \
  ""                                                                                                           \
  Respawn                             x "respawn-window -k"                                                    \
  Kill                                X kill-window                                                            \
}

# pane menu
# https://github.com/tmux/tmux/blob/ae8f2208c98e3c2d6e3fe4cad2281dce8fd11f31/key-bindings.c#L478
# -O option added to keep window open until option selected
bind -n MouseDown3Pane { if -Ft= '#{||:#{mouse_any_flag},#{&&:#{pane_in_mode},#{?#{m/r:(copy|view)-mode,#{pane_mode}},0,1}}}' { select-pane -t=; send -M } { display-menu -O -t= -xM -yM -T '#[align=centre]#{pane_index} (#{pane_id})' \
  "Split right"                       |   "split-window -h -c \"#{pane_current_path}\""                        \
  "Split down"                        -   "split-window -v -c \"#{pane_current_path}\""                        \
  ""                                                                                                           \
  "#{?window_zoomed_flag,Unzoom,Zoom}" z  "resize-pane -Z"                                                     \
  "#{?pane_marked,Unmark,Mark}"       m   "select-pane -m"                                                     \
  "#{?pane_marked_set,,-}Swap Marked" s   "swap-pane; select-pane -M"                                          \
  ""                                                                                                           \
  Respawn                             x   "respawn-pane -k"                                                    \
  "Close split"                       X   kill-pane                                                            \
} }

# keybinds ----------
unbind C-b                                # prefix using ctrl-space
set -g prefix C-Space
bind C-Space send-prefix

unbind '"'
unbind %
bind | split-window -h                    # split panes using | and -
bind - split-window -v

# plugins ----------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sessionist'

# theme ----------
set -g status-position top
set -g @dracula-show-powerline true
set -g @dracula-show-flags true
set -g @dracula-show-empty-plugins false
set -g @dracula-show-left-sep " "
set -g @dracula-show-right-sep 
set -g @dracula-show-left-icon "#h | #S"
set -g @dracula-cpu-usage-label " "
set -g @dracula-ram-usage-label " "
set -g @dracula-gpu-usage-label "󰢮 "
set -g @dracula-gpu-vram-label " "
set -g @dracula-cpu-display-load false
set -g @dracula-plugins "attached-clients cpu-usage ram-usage gpu-usage gpu-ram-usage "
set -g @plugin 'dracula/tmux'

run '~/.tmux/plugins/tpm/tpm'             # enable plugins
